!function(){"use strict";angular.module("angularplasmid.services",[]).factory("SVGUtil",function(){function e(e,t){var r="round";return"undefined"==typeof t||0===+t?Math[r](e):(e=+e,t=+t,isNaN(e)||"number"!=typeof t||t%1!==0?0/0:(e=e.toString().split("e"),e=Math[r](+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function t(e){f.push(e)}function r(e){var t;for(t=0;t<f.length;t+=1)if(f[t].id===e)return f[t]}function n(e,t,r,n){var i=(n-90)*Math.PI/180;return{x:e+r*Math.cos(i),y:t+r*Math.sin(i)}}function i(e,t){var r,n,i=["id","name","class","style","filter"];for(n=0;n<i.length;n+=1)r=i[n],e[0].hasAttribute(r)&&(t.attr(r,e.attr(r)),e.removeAttr(r))}function a(e,t,r){var n,i="http://www.w3.org/2000/svg",a=document.createElementNS(i,e);return r=r||[],angular.forEach(t,function(e){r.indexOf(e)<0&&(n=t[e],null===n||e.match(/\$/)||"string"==typeof n&&""===n||a.setAttribute(e,n))}),a}function u(e){angular.forEach(["id","class","style"],function(t){e.removeAttribute(t)})}function l(e,t,r,i){var a,u,l;return e=Number(e||0),t=Number(t||0),r=Number(r||0),i=Number(i||0),a={start:n(e,t,r,359.99),end:n(e,t,r,0)},u={start:n(e,t,r+i,359.99),end:n(e,t,r+i,0)},l=["M",a.start.x,a.start.y,"A",r,r,0,1,0,a.end.x,a.end.y,"M",u.start.x,u.start.y,"A",r+i,r+i,0,1,0,u.end.x,u.end.y].join(" ")}function c(e,t,r,i,a,u,l,c){var d,s,o,f,g,p,h,m,b,y,v,w,j;return e=Number(e),t=Number(t),r=Number(r),i=Number(i),a=Number(a),u=Number(u),l=l||{width:0,length:0,angle:0},c=c||{width:0,length:0,angle:0},i===a?(s=n(e,t,r,i),f=n(e,t,r+u,i),d=["M",s.x,s.y,"L",f.x,f.y].join(" ")):1===u?(s=n(e,t,r,i),f=n(e,t,r,a),g=a>i?180>=a-i?"0":"1":180>=a-i?"1":"0",d=["M",s.x,s.y,"A",r,r,0,g,1,f.x,f.y].join(" ")):(a-=c.length<0?0:c.length,i+=l.length<0?0:l.length,s=n(e,t,r,a),f=n(e,t,r,i),p=n(e,t,r-l.width,i+l.angle),h=n(e,t,r+u/2,i-l.length),m=n(e,t,r+u+l.width,i+l.angle),b=n(e,t,r+u,i),y=n(e,t,r+u+c.width,a-c.angle),v=n(e,t,r+u/2,a+c.length),w=n(e,t,r-c.width,a-c.angle),j=n(e,t,r,a),o=n(e,t,r+u,a),g=180>=a-i?"0":"1",d=["M",s.x,s.y,"A",r,r,0,g,0,f.x,f.y,"L",p.x,p.y,"L",h.x,h.y,"L",m.x,m.y,"L",b.x,b.y,"A",r+u,r+u,0,g,1,o.x,o.y,"L",y.x,y.y,"L",v.x,v.y,"L",w.x,w.y,"L",j.x,j.y,"z"].join(" ")),d}function d(t,r,n,i,a,u){t=Number(t||0),r=Number(r||0),n=Number(n||0),i=Number(i||0),a=Number(a||0),u=Number(u||2);var l,c,d,s,o=Number(i)>0?Number(a)/Number(i):0,f=2*Math.PI/o,g=-1,p="";for(s=0;o>s;s+=1)l=f*s-Math.PI/2,d=Math.cos(l),c=Math.sin(l),p+="M"+e(t+n*d,g)+","+e(r+n*c,g)+" L"+e(t+(n+u)*d,g)+","+e(r+(n+u)*c,g)+" ";return p=p||"M 0,0"}function s(t,r,n,i,a){t=Number(t),r=Number(r),n=Number(n),i=Number(i),a=Number(a);var u,l,c,d,s=Number(i)>0?Number(a)/Number(i):0,o=2*Math.PI/s,f=-1,g=[];for(d=0;s>d;d+=1)u=o*d-Math.PI/2,c=Math.cos(u),l=Math.sin(u),g.push({x:e(t+n*c,f),y:e(r+n*l,f),text:i*d});return g}function o(e,t){return isNaN(e)?t||0:Number(e)}var f=[],g=[],p=[];return{api:{addPlasmid:t,plasmids:f,plasmid:r,plasmidtracks:g,trackmarkers:p},util:{polarToCartesian:n,swapProperties:i,Numeric:o},svg:{createNode:a,removeAttributes:u,path:{donut:l,arc:c,scale:d},element:{scalelabels:s}}}})}(),function(){"use strict";angular.module("angularplasmid",["angularplasmid.services"]).directive("plasmidapi",["SVGUtil",function(e){return{restrict:"AE",link:function(t,r,n){t[n.name]=e.api}}}]).directive("plasmid",["SVGUtil",function(){return{restrict:"AE",type:"svg",template:"<svg></svg>",replace:!0,transclude:!0,require:"plasmid",scope:{plasmidheight:"@",plasmidwidth:"@",sequencelength:"@",sequence:"@"},link:{pre:function(e,t,r,n){n.init(t)},post:function(e,t,r,n,i){i(e.$parent,function(e){t.append(e)}),e.$watchGroup(["plasmidheight","plasmidwidth","sequencelength","sequence"],function(){n.draw()})}},controller:["$scope","SVGUtil",function(e,t){var r,n,i=[];n=this,n.init=function(e){t.api.addPlasmid(n),r=e,n.id=r.attr("id")},n.draw=function(){var e=n.dimensions;r.attr("height",e.height),r.attr("width",e.width),angular.forEach(i,function(e){e.draw()})},n.addTrack=function(e){i.push(e)},Object.defineProperty(n,"center",{get:function(){var e=n.dimensions;return{x:e.width/2,y:e.height/2}}}),Object.defineProperty(n,"dimensions",{get:function(){return{height:t.util.Numeric(e.plasmidheight,300),width:t.util.Numeric(e.plasmidwidth,300)}}}),Object.defineProperty(n,"sequencelength",{get:function(){return n.sequence?n.sequence.length:t.util.Numeric(e.sequencelength)}}),Object.defineProperty(n,"sequence",{get:function(){return e.sequence}}),n.tracks=i}]}}]).directive("plasmidtrack",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["plasmidtrack","^plasmid"],scope:{radius:"@",width:"@"},link:{pre:function(e,t,r,n){var i=n[0],a=n[1],u=angular.element(t.children()[0]);i.init(u,a)},post:function(t,r,n,i,a){a(t.$parent,function(e){r.append(e)});var u=angular.element(r),l=angular.element(r.children()[0]),c=i[0];e.util.swapProperties(u,l),l.attr("fill-rule","evenodd"),t.$watchGroup(["radius","width"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,i,a=[],u=[],l=[];i=this,i.init=function(e,t){r=t,r.addTrack(this),i.plasmid=r,n=e},i.draw=function(){var t=i.center,r=e.svg.path.donut(t.x,t.y,i.radius,i.width);n.attr("d",r),angular.forEach(a,function(e){e.draw()}),angular.forEach(u,function(e){e.draw()}),angular.forEach(l,function(e){e.draw()})},i.addMarker=function(e){a.push(e)},i.addScale=function(e){u.push(e)},i.addLabel=function(e){l.push(e)},i.markergroup=function(e){var t=[];return angular.forEach(a,function(r){r.markergroup===e&&t.push(r)}),t},i.getPosition=function(t,n,a){a=Number(a||0),t=Number(t);var u,l,c=1,d=2,s=i.center,o=r.sequencelength;if(o>0){switch(l=t/o*360,n){case c:u=i.radius+a;break;case d:u=i.radius+i.width+a;break;default:u=i.radius+i.width/2+a}return e.util.polarToCartesian(s.x,s.y,u,l)}},Object.defineProperty(i,"center",{get:function(){return r.center}}),Object.defineProperty(i,"radius",{get:function(){return e.util.Numeric(t.radius,100)}}),Object.defineProperty(i,"width",{get:function(){return e.util.Numeric(t.width,25)}}),i.markers=a,i.scales=u,i.labels=l}]}}]).directive("trackscale",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path><g></g></g>",replace:!0,transclude:!0,require:["trackscale","^plasmidtrack"],scope:{interval:"@",vadjust:"@",ticksize:"@",direction:"@",showlabels:"@",labelvadjust:"@",labelclass:"@",labelstyle:"@"},link:{pre:function(e,t,r,n){var i=n[0],a=n[1],u=angular.element(t.children()[0]),l=angular.element(t.children()[1]);i.init(u,l,a)},post:function(t,r,n,i,a){var u,l,c;a(t.$parent,function(e){r.append(e)}),u=angular.element(r),l=angular.element(r.children()[0]),e.util.swapProperties(u,l),c=i[0],t.$watchGroup(["interval","vadjust","ticksize","labelvadjust"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,i,a,u=15,l=3;n=this,n.init=function(e,t,u){r=u,r.addScale(n),n.track=r,i=e,a=t},n.draw=function(){var t=r.center,a=e.svg.path.scale(t.x,t.y,n.radius,n.interval,n.total,n.ticksize);i.attr("d",a),n.showlabels&&n.drawLabel()},n.drawLabel=function(){var t,i,u,l=r.center;for(u=e.svg.element.scalelabels(l.x,l.y,n.labelradius,n.interval,n.total),a.empty(),t=0;t<=u.length-1;t+=1)i=angular.element(e.svg.createNode("text")),n.labelclass&&i.attr("class",n.labelclass),n.labelstyle&&i.attr("style",n.labelstyle),i.attr("x",u[t].x),i.attr("y",u[t].y),i.css("text-anchor","middle"),i.css("alignment-baseline","middle"),i.text(u[t].text),a.append(i)},Object.defineProperty(n,"radius",{get:function(){return(n.inwardflg?r.radius:r.radius+r.width)+(n.inwardflg?-1:1)*n.vadjust+(n.inwardflg?-n.ticksize:0)}}),Object.defineProperty(n,"interval",{get:function(){return e.util.Numeric(t.interval)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"ticksize",{get:function(){return e.util.Numeric(t.ticksize,l)}}),Object.defineProperty(n,"inwardflg",{get:function(){return"in"===t.direction?!0:!1}}),Object.defineProperty(n,"total",{get:function(){return r.plasmid.sequencelength}}),Object.defineProperty(n,"showlabels",{get:function(){return"1"===t.showlabels?!0:!1}}),Object.defineProperty(n,"labelvadjust",{get:function(){return e.util.Numeric(t.labelvadjust,u)}}),Object.defineProperty(n,"labelclass",{get:function(){return t.labelclass}}),Object.defineProperty(n,"labelstyle",{get:function(){return t.labelstyle}}),Object.defineProperty(n,"labelradius",{get:function(){return n.radius+n.labelvadjust*(n.inwardflg?-1:1)}})}]}}]).directive("tracklabel",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<text></text>",replace:!0,transclude:!0,require:["tracklabel","^plasmidtrack"],scope:{text:"@",hadjust:"@",vadjust:"@"},link:{pre:function(e,t,r,n){var i=n[0],a=n[1],u=angular.element(t[0]);i.init(u,a)},post:function(e,t,r,n,i){var a;i(e.$parent,function(e){t.append(e)}),a=n[0],e.$watchGroup(["text","vadjust","hadjust"],function(){a.draw()})}},controller:["$scope",function(t){var r,n,i;n=this,n.init=function(e,t){r=t,r.addLabel(n),n.track=r,i=e},n.draw=function(){var e=r.center;i.attr("x",e.x+n.hadjust),i.attr("y",e.y+n.vadjust),i.css("text-anchor","middle"),i.css("alignment-baseline","middle"),i.text(n.text)},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"text",{get:function(){return t.text}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust,0)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust,0)}}),Object.defineProperty(n,"dimensions",{get:function(){return i[0].getBBox()}})}]}}]).directive("trackmarker",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["trackmarker","^plasmidtrack"],scope:{start:"@",end:"@",vadjust:"@",wadjust:"@",markergroup:"@",arrowstartlength:"@",arrowstartwidth:"@",arrowstartangle:"@",arrowendlength:"@",arrowendwidth:"@",arrowendangle:"@",markerclick:"&"},link:{pre:function(e,t,r,n){var i=n[0],a=n[1],u=angular.element(t.children()[0]);i.init(u,a)},post:function(t,r,n,i,a){var u,l,c=i[0];a(t.$parent,function(e){r.append(e)}),u=angular.element(r),l=angular.element(r.children()[0]),e.util.swapProperties(u,l),l.on("click",function(e){t.markerclick({$e:e,$marker:c})}),t.$watchGroup(["start","end","vadjust","wadjust"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,i,a=[];n=this,n.init=function(e,t){r=t,r.addMarker(this),i=e,n.track=r},n.draw=function(){i.attr("d",n.getPath()),angular.forEach(a,function(e){e.draw()})},n.addMarkerLabel=function(e){a.push(e)},n.getPath=function(){var t=r.center,i=n.angle,a=n.radius;return e.svg.path.arc(t.x,t.y,a.inner,i.start,i.end,n.width,n.arrowstart,n.arrowend)},n.getPosition=function(t,i,a,u){var l,c,d,s,o,f="start",g="end",p="inner",h="outer";if(l=r.center,s=n.radius,o=n.angle,t=e.util.Numeric(t),i=e.util.Numeric(i),void 0!==u&&void 0!==a){switch(u){case p:c=s.inner+i;break;case h:c=s.outer+i;break;default:c=s.middle+i}switch(a){case f:d=o.start+t;break;case g:d=o.end+t;break;default:d=o.middle+t}return e.util.polarToCartesian(l.x,l.y,c,d)}return c={outer:s.outer+i,inner:s.inner+i,middle:s.middle+i},d={begin:o.start+t,end:o.end+t,middle:o.middle+t},{outer:{begin:e.util.polarToCartesian(l.x,l.y,c.outer,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.outer,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.outer,d.end)},middle:{begin:e.util.polarToCartesian(l.x,l.y,c.middle,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.middle,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.middle,d.end)},inner:{begin:e.util.polarToCartesian(l.x,l.y,c.inner,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.inner,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.inner,d.end)}}},n.fireClick=function(e){t.markerclick({$e:e.$e,$marker:e.$marker})},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"radius",{get:function(){return{inner:r.radius+n.vadjust,outer:r.radius+n.vadjust+n.width,middle:r.radius+n.vadjust+n.width/2}}}),Object.defineProperty(n,"angle",{get:function(){var i,a,u,l;return i=n.start/r.plasmid.sequencelength*360,l=t.end||t.start,a=e.util.Numeric(l)/r.plasmid.sequencelength*360,a+=i>a?360:0,u=i+(a-i)/2,{start:i,middle:u,end:a}}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"wadjust",{get:function(){return e.util.Numeric(t.wadjust)}}),Object.defineProperty(n,"width",{get:function(){return r.width+n.wadjust}}),Object.defineProperty(n,"start",{get:function(){return e.util.Numeric(t.start)}}),Object.defineProperty(n,"end",{get:function(){return e.util.Numeric(t.end)}}),Object.defineProperty(n,"arrowstart",{get:function(){return{width:e.util.Numeric(t.arrowstartwidth),length:e.util.Numeric(t.arrowstartlength),angle:e.util.Numeric(t.arrowstartangle)}}}),Object.defineProperty(n,"arrowend",{get:function(){return{width:e.util.Numeric(t.arrowendwidth),length:e.util.Numeric(t.arrowendlength),angle:e.util.Numeric(t.arrowendangle)}}}),Object.defineProperty(n,"markergroup",{get:function(){return t.markergroup}}),Object.defineProperty(n,"sequence",{get:function(){var e=n.track.plasmid.sequence;return n.start>n.end?e.substring(n.start-1,e.length-1)+e.substring(0,n.end-1):e.substring(n.start-1,n.end-1)}}),n.labels=a}]}}]).directive("markerlabel",["SVGUtil",function(e){return{restrict:"AE",type:"svg",transclude:!0,template:function(e,t){return"path"===t.type?'<g><path></path><path id="" style="fill:none;stroke:none"></path><text><textpath xlink:href="#">{{text}}</textpath></text></g>':"<g><path></path><text>{{text}}</text></g>"},require:["markerlabel","^trackmarker"],replace:!0,scope:{text:"@",valign:"@",vadjust:"@",halign:"@",hadjust:"@",type:"@",showline:"@",linestyle:"@",lineclass:"@",linevadjust:"@",labelclick:"&"},link:{pre:function(e,t,r,n){var i,a,u,l,c=n[0],d=n[1];"path"===r.type?(i=angular.element(t[0]),l=angular.element(t.children()[0]),a=angular.element(t.children()[1]),u=angular.element(t.children()[2])):(i=angular.element(t[0]),l=angular.element(t.children()[0]),u=angular.element(t.children()[1])),c.init(u,i,a,l,d)},post:function(t,r,n,i,a){a(t.$parent,function(e){r.append(e)});var u=i[0],l=i[1],c=angular.element(r),d=angular.element("path"===n.type?r.children()[2]:r.children()[1]);d.attr("text-anchor","middle"),d.attr("alignment-baseline","middle"),e.util.swapProperties(c,d),n.labelclick?d.on("click",function(e){t.labelclick({$e:e,$label:u})}):d.on("click",function(e){l.fireClick({$e:e,$marker:l})})}},controller:["$scope",function(t){var r,n,i,a,u,l;n=this,n.init=function(e,t,c,d,s){r=s,r.addMarkerLabel(n),n.marker=r,i=e,a=c,u=d,l=t},n.draw=function(){var e,t,l,c,d,s,o,f,g,p="middle",h="inner",m="outer",b="start",y="end";if("path"===n.type){switch(e=angular.element(i.children()[0]),t=window.getComputedStyle(i[0]).fontSize.replace("px",""),l=n.valign===m?0:n.valign===h?Number(t||0):Number(t||0)/2,a.attr("d",n.getPath(n.hadjust,n.vadjust-l,n.halign,n.valign)),n.halign){case b:i.attr("text-anchor","start"),e[0].setAttribute("startOffset","0%");break;case y:i.attr("text-anchor","end"),e[0].setAttribute("startOffset","100%");break;default:i.attr("text-anchor","middle"),e[0].setAttribute("startOffset","50%")}c="TPATH"+(Math.random()+1).toString(36).substring(3,7),a.attr("id",c),e.attr("xlink:href","#"+c)}else d=r.getPosition(n.hadjust,n.vadjust,n.halign,n.valign),i.attr("x",d.x),i.attr("y",d.y);n.showlineflg&&(s=r.getPosition(n.hadjust,n.vadjust+n.linevadjust,n.halign,n.valign),f=r.getPosition(),g=n.valign===h?f.inner:n.valign===p?f.middle:f.outer,o=n.halign===b?g.begin:n.halign===y?g.end:g.middle,u.attr("d",["M",s.x,s.y,"L",o.x,o.y].join(" ")),n.linestyle||n.lineclass||u.attr("style","stroke:#000"),n.linestyle&&u.attr("style",n.linestyle),n.lineclass&&u.attr("class",n.lineclass))},n.getPath=function(t,n,i,a){var u,l,c,d,s,o="inner",f="outer",g="start",p="end",h=r.center;switch(l=r.radius,a){case o:u=l.inner;break;case f:u=l.outer;break;default:u=l.middle}switch(c=r.angle,i){case g:d=c.start,s=c.start+359.99;break;case p:d=c.end+1,s=c.end;break;default:d=c.middle+180.05,s=c.middle+179.95}return e.svg.path.arc(h.x,h.y,u+Number(n||0),d+Number(t||0),s+Number(t||0),1)},Object.defineProperty(n,"showlineflg",{get:function(){return"1"===t.showline?!0:!1}}),Object.defineProperty(n,"halign",{get:function(){return t.halign||"middle"}}),Object.defineProperty(n,"valign",{get:function(){return t.valign||"middle"}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"type",{get:function(){return t.type}}),Object.defineProperty(n,"linevadjust",{get:function(){return e.util.Numeric(t.linevadjust)}}),Object.defineProperty(n,"linestyle",{get:function(){return t.linestyle}}),Object.defineProperty(n,"lineclass",{get:function(){return t.lineclass}}),Object.defineProperty(n,"text",{get:function(){return t.text}})}]}}]).directive("spinner",function(){return{restrict:"A",scope:{ngModel:"="},link:function(e,t){t.bind("keydown keypress",function(t){38===t.which?e.$apply(function(){e.ngModel=Number(e.ngModel)-6}):40===t.which&&e.$apply(function(){e.ngModel=Number(e.ngModel)+6})})}}})}();