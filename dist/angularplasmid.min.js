!function(){"use strict";angular.module("angularplasmid.services",[]).factory("SVGUtil",function(){function e(e,t){var r="round";return"undefined"==typeof t||0===+t?Math[r](e):(e=+e,t=+t,isNaN(e)||"number"!=typeof t||t%1!==0?0/0:(e=e.toString().split("e"),e=Math[r](+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function t(e){f.push(e)}function r(e){var t;for(t=0;t<f.length;t+=1)if(f[t].id===e)return f[t]}function n(e,t,r,n){var a=(n-90)*Math.PI/180;return{x:e+r*Math.cos(a),y:t+r*Math.sin(a)}}function a(e,t){var r,n,a=["id","name","class","style","filter","ng-attr-style","ng-attr-class"];for(n=0;n<a.length;n+=1)r=a[n],e[0].hasAttribute(r)&&(t.attr(r,e.attr(r)),e.removeAttr(r))}function i(e,t,r){var n,a="http://www.w3.org/2000/svg",i=document.createElementNS(a,e);return r=r||[],angular.forEach(t,function(e){r.indexOf(e)<0&&(n=t[e],null===n||e.match(/\$/)||"string"==typeof n&&""===n||i.setAttribute(e,n))}),i}function u(e){angular.forEach(["id","class","style"],function(t){e.removeAttribute(t)})}function l(e,t,r,a){var i,u,l;return e=Number(e||0),t=Number(t||0),r=Number(r||0),a=Number(a||0),i={start:n(e,t,r,359.99),end:n(e,t,r,0)},u={start:n(e,t,r+a,359.99),end:n(e,t,r+a,0)},l=["M",i.start.x,i.start.y,"A",r,r,0,1,0,i.end.x,i.end.y,"M",u.start.x,u.start.y,"A",r+a,r+a,0,1,0,u.end.x,u.end.y].join(" ")}function c(e,t,r,a,i,u,l,c){var d,s,o,f,p,g,h,m,b,y,v,w,j;return e=Number(e),t=Number(t),r=Number(r),a=Number(a),i=Number(i),u=Number(u),l=l||{width:0,length:0,angle:0},c=c||{width:0,length:0,angle:0},a===i?(s=n(e,t,r,a),f=n(e,t,r+u,a),d=["M",s.x,s.y,"L",f.x,f.y].join(" ")):1===u?(s=n(e,t,r,a),f=n(e,t,r,i),p=i>a?180>=i-a?"0":"1":180>=i-a?"1":"0",d=["M",s.x,s.y,"A",r,r,0,p,1,f.x,f.y].join(" ")):(i-=c.length<0?0:c.length,a+=l.length<0?0:l.length,s=n(e,t,r,i),f=n(e,t,r,a),g=n(e,t,r-l.width,a+l.angle),h=n(e,t,r+u/2,a-l.length),m=n(e,t,r+u+l.width,a+l.angle),b=n(e,t,r+u,a),y=n(e,t,r+u+c.width,i-c.angle),v=n(e,t,r+u/2,i+c.length),w=n(e,t,r-c.width,i-c.angle),j=n(e,t,r,i),o=n(e,t,r+u,i),p=180>=i-a?"0":"1",d=["M",s.x,s.y,"A",r,r,0,p,0,f.x,f.y,"L",g.x,g.y,"L",h.x,h.y,"L",m.x,m.y,"L",b.x,b.y,"A",r+u,r+u,0,p,1,o.x,o.y,"L",y.x,y.y,"L",v.x,v.y,"L",w.x,w.y,"L",j.x,j.y,"z"].join(" ")),d}function d(t,r,n,a,i,u){t=Number(t||0),r=Number(r||0),n=Number(n||0),a=Number(a||0),i=Number(i||0),u=Number(u||2);var l,c,d,s,o=Number(a)>0?Number(i)/Number(a):0,f=2*Math.PI/o,p=-1,g="";for(s=0;o>s;s+=1)l=f*s-Math.PI/2,d=Math.cos(l),c=Math.sin(l),g+="M"+e(t+n*d,p)+","+e(r+n*c,p)+" L"+e(t+(n+u)*d,p)+","+e(r+(n+u)*c,p)+" ";return g=g||"M 0,0"}function s(t,r,n,a,i){t=Number(t),r=Number(r),n=Number(n),a=Number(a),i=Number(i);var u,l,c,d,s=Number(a)>0?Number(i)/Number(a):0,o=2*Math.PI/s,f=-1,p=[];for(d=0;s>d;d+=1)u=o*d-Math.PI/2,c=Math.cos(u),l=Math.sin(u),p.push({x:e(t+n*c,f),y:e(r+n*l,f),text:a*d});return p}function o(e,t){return isNaN(e)?t||0:Number(e)}var f=[],p=[],g=[];return{api:{addPlasmid:t,plasmids:f,plasmid:r,plasmidtracks:p,trackmarkers:g},util:{polarToCartesian:n,swapProperties:a,Numeric:o},svg:{createNode:i,removeAttributes:u,path:{donut:l,arc:c,scale:d},element:{scalelabels:s}}}})}(),function(){"use strict";angular.module("angularplasmid",["angularplasmid.services"]).directive("plasmidapi",["SVGUtil",function(e){return{restrict:"AE",link:function(t,r,n){t[n.name]=e.api}}}]).directive("plasmid",["SVGUtil",function(){return{restrict:"AE",type:"svg",template:"<svg></svg>",replace:!0,transclude:!0,require:"plasmid",scope:{plasmidheight:"@",plasmidwidth:"@",sequencelength:"@",sequence:"@"},link:{pre:function(e,t,r,n){n.init(t)},post:function(e,t,r,n,a){a(e.$parent,function(e){t.append(e)}),e.$watchGroup(["plasmidheight","plasmidwidth","sequencelength","sequence"],function(){n.draw()})}},controller:["$scope","SVGUtil",function(e,t){var r,n,a=[];n=this,n.type="plasmid",n.init=function(e){t.api.addPlasmid(n),r=e,n.id=r.attr("id")},n.draw=function(){var e=n.dimensions;r.attr("height",e.height),r.attr("width",e.width),angular.forEach(a,function(e){e.draw()})},n.addTrack=function(e){a.push(e)},Object.defineProperty(n,"center",{get:function(){var e=n.dimensions;return{x:e.width/2,y:e.height/2}}}),Object.defineProperty(n,"dimensions",{get:function(){return{height:t.util.Numeric(e.plasmidheight,300),width:t.util.Numeric(e.plasmidwidth,300)}}}),Object.defineProperty(n,"sequencelength",{get:function(){return n.sequence?n.sequence.length:t.util.Numeric(e.sequencelength)}}),Object.defineProperty(n,"sequence",{get:function(){return e.sequence}}),n.tracks=a}]}}]).directive("plasmidtrack",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["plasmidtrack","^plasmid"],scope:{radius:"@",width:"@",trackclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],u=angular.element(t.children()[0]);a.init(u,i)},post:function(t,r,n,a,i){i(t.$parent,function(e){r.append(e)});var u=angular.element(r),l=angular.element(r.children()[0]),c=a[0];e.util.swapProperties(u,l),l.attr("fill-rule","evenodd"),l.on("click",function(e){t.trackclick({$event:e,$track:c})}),t.$watchGroup(["radius","width"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,a,i=[],u=[],l=[];a=this,a.type="plasmidtrack",a.init=function(e,t){r=t,r.addTrack(a),a.plasmid=r,n=e},a.draw=function(){var t=a.center,r=e.svg.path.donut(t.x,t.y,a.radius,a.width);n.attr("d",r),angular.forEach(i,function(e){e.draw()}),angular.forEach(u,function(e){e.draw()}),angular.forEach(l,function(e){e.draw()})},a.addMarker=function(e){i.push(e)},a.addScale=function(e){u.push(e)},a.addLabel=function(e){l.push(e)},a.markergroup=function(e){var t=[];return angular.forEach(i,function(r){r.markergroup===e&&t.push(r)}),t},a.getPosition=function(t,n,i){i=Number(i||0),t=Number(t);var u,l,c=1,d=2,s=a.center,o=r.sequencelength;if(o>0){switch(l=t/o*360,n){case c:u=a.radius+i;break;case d:u=a.radius+a.width+i;break;default:u=a.radius+a.width/2+i}return e.util.polarToCartesian(s.x,s.y,u,l)}},Object.defineProperty(a,"center",{get:function(){return r.center}}),Object.defineProperty(a,"radius",{get:function(){return e.util.Numeric(t.radius,100)}}),Object.defineProperty(a,"width",{get:function(){return e.util.Numeric(t.width,25)}}),a.markers=i,a.scales=u,a.labels=l}]}}]).directive("trackscale",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path><g></g></g>",replace:!0,transclude:!0,require:["trackscale","^plasmidtrack"],scope:{interval:"@",vadjust:"@",ticksize:"@",direction:"@",showlabels:"@",labelvadjust:"@",labelclass:"@",labelstyle:"@"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],u=angular.element(t.children()[0]),l=angular.element(t.children()[1]);a.init(u,l,i)},post:function(t,r,n,a,i){var u,l,c;i(t.$parent,function(e){r.append(e)}),u=angular.element(r),l=angular.element(r.children()[0]),e.util.swapProperties(u,l),c=a[0],t.$watchGroup(["interval","vadjust","ticksize","labelvadjust"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,a,i,u=15,l=3;n=this,n.type="trackscale",n.init=function(e,t,u){r=u,r.addScale(n),n.track=r,a=e,i=t},n.draw=function(){var t=r.center,i=e.svg.path.scale(t.x,t.y,n.radius,n.interval,n.total,n.ticksize);a.attr("d",i),n.showlabels&&n.drawLabel()},n.drawLabel=function(){var t,a,u,l=r.center;for(u=e.svg.element.scalelabels(l.x,l.y,n.labelradius,n.interval,n.total),i.empty(),t=0;t<=u.length-1;t+=1)a=angular.element(e.svg.createNode("text")),n.labelclass&&a.attr("class",n.labelclass),n.labelstyle&&a.attr("style",n.labelstyle),a.attr("x",u[t].x),a.attr("y",u[t].y),a.css("text-anchor","middle"),a.css("alignment-baseline","middle"),a.text(u[t].text),i.append(a)},Object.defineProperty(n,"radius",{get:function(){return(n.inwardflg?r.radius:r.radius+r.width)+(n.inwardflg?-1:1)*n.vadjust+(n.inwardflg?-n.ticksize:0)}}),Object.defineProperty(n,"interval",{get:function(){return e.util.Numeric(t.interval)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"ticksize",{get:function(){return e.util.Numeric(t.ticksize,l)}}),Object.defineProperty(n,"inwardflg",{get:function(){return"in"===t.direction?!0:!1}}),Object.defineProperty(n,"total",{get:function(){return r.plasmid.sequencelength}}),Object.defineProperty(n,"showlabels",{get:function(){return"1"===t.showlabels?!0:!1}}),Object.defineProperty(n,"labelvadjust",{get:function(){return e.util.Numeric(t.labelvadjust,u)}}),Object.defineProperty(n,"labelclass",{get:function(){return t.labelclass}}),Object.defineProperty(n,"labelstyle",{get:function(){return t.labelstyle}}),Object.defineProperty(n,"labelradius",{get:function(){return n.radius+n.labelvadjust*(n.inwardflg?-1:1)}})}]}}]).directive("tracklabel",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<text></text>",replace:!0,transclude:!0,require:["tracklabel","^plasmidtrack"],scope:{text:"@",hadjust:"@",vadjust:"@"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],u=angular.element(t[0]);a.init(u,i)},post:function(e,t,r,n,a){var i;a(e.$parent,function(e){t.append(e)}),i=n[0],e.$watchGroup(["text","vadjust","hadjust"],function(){i.draw()})}},controller:["$scope",function(t){var r,n,a;n=this,n.type="tracklabel",n.init=function(e,t){r=t,r.addLabel(n),n.track=r,a=e},n.draw=function(){var e=r.center;a.attr("x",e.x+n.hadjust),a.attr("y",e.y+n.vadjust),a.css("text-anchor","middle"),a.css("alignment-baseline","middle"),a.text(n.text)},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"text",{get:function(){return t.text}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust,0)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust,0)}}),Object.defineProperty(n,"dimensions",{get:function(){return a[0].getBBox()}})}]}}]).directive("trackmarker",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["trackmarker","^plasmidtrack"],scope:{start:"@",end:"@",vadjust:"@",wadjust:"@",markergroup:"@",arrowstartlength:"@",arrowstartwidth:"@",arrowstartangle:"@",arrowendlength:"@",arrowendwidth:"@",arrowendangle:"@",markerclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],u=angular.element(t.children()[0]);a.init(u,i)},post:function(t,r,n,a,i){var u,l,c=a[0];i(t.$parent,function(e){r.append(e)}),u=angular.element(r),l=angular.element(r.children()[0]),e.util.swapProperties(u,l),l.on("click",function(e){t.markerclick({$event:e,$marker:c})}),t.$watchGroup(["start","end","vadjust","wadjust"],function(){c.draw()})}},controller:["$scope",function(t){var r,n,a,i=[];n=this,n.type="trackmarker",n.init=function(e,t){r=t,r.addMarker(n),a=e,n.track=r},n.draw=function(){a.attr("d",n.getPath()),angular.forEach(i,function(e){e.draw()})},n.addMarkerLabel=function(e){i.push(e)},n.getPath=function(){var t=r.center,a=n.angle,i=n.radius;return e.svg.path.arc(t.x,t.y,i.inner,a.start,a.end,n.width,n.arrowstart,n.arrowend)},n.getPosition=function(t,a,i,u){var l,c,d,s,o,f="start",p="end",g="inner",h="outer";if(l=r.center,s=n.radius,o=n.angle,t=e.util.Numeric(t),a=e.util.Numeric(a),void 0!==u&&void 0!==i){switch(u){case g:c=s.inner+a;break;case h:c=s.outer+a;break;default:c=s.middle+a}switch(i){case f:d=o.start+t;break;case p:d=o.end+t;break;default:d=o.middle+t}return e.util.polarToCartesian(l.x,l.y,c,d)}return c={outer:s.outer+a,inner:s.inner+a,middle:s.middle+a},d={begin:o.start+t,end:o.end+t,middle:o.middle+t},{outer:{begin:e.util.polarToCartesian(l.x,l.y,c.outer,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.outer,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.outer,d.end)},middle:{begin:e.util.polarToCartesian(l.x,l.y,c.middle,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.middle,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.middle,d.end)},inner:{begin:e.util.polarToCartesian(l.x,l.y,c.inner,d.begin),middle:e.util.polarToCartesian(l.x,l.y,c.inner,d.middle),end:e.util.polarToCartesian(l.x,l.y,c.inner,d.end)}}},n.fireClick=function(e){t.markerclick({$event:e.$event,$marker:e.$marker})},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"radius",{get:function(){return{inner:r.radius+n.vadjust,outer:r.radius+n.vadjust+n.width,middle:r.radius+n.vadjust+n.width/2}}}),Object.defineProperty(n,"angle",{get:function(){var a,i,u,l;return a=n.start/r.plasmid.sequencelength*360,l=t.end||t.start,i=e.util.Numeric(l)/r.plasmid.sequencelength*360,i+=a>i?360:0,u=a+(i-a)/2,{start:a,middle:u,end:i}}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"wadjust",{get:function(){return e.util.Numeric(t.wadjust)}}),Object.defineProperty(n,"width",{get:function(){return r.width+n.wadjust}}),Object.defineProperty(n,"start",{get:function(){return e.util.Numeric(t.start)}}),Object.defineProperty(n,"end",{get:function(){return e.util.Numeric(t.end)}}),Object.defineProperty(n,"arrowstart",{get:function(){return{width:e.util.Numeric(t.arrowstartwidth),length:e.util.Numeric(t.arrowstartlength),angle:e.util.Numeric(t.arrowstartangle)}}}),Object.defineProperty(n,"arrowend",{get:function(){return{width:e.util.Numeric(t.arrowendwidth),length:e.util.Numeric(t.arrowendlength),angle:e.util.Numeric(t.arrowendangle)}}}),Object.defineProperty(n,"markergroup",{get:function(){return t.markergroup}}),Object.defineProperty(n,"sequence",{get:function(){var e=n.track.plasmid.sequence;return n.start>n.end?e.substring(n.start-1,e.length-1)+e.substring(0,n.end-1):e.substring(n.start-1,n.end-1)}}),n.labels=i}]}}]).directive("markerlabel",["SVGUtil",function(e){return{restrict:"AE",type:"svg",transclude:!0,template:function(e,t){return"path"===t.type?'<g><path></path><path id="" style="fill:none;stroke:none"></path><text><textpath xlink:href="#">{{text}}</textpath></text></g>':"<g><path></path><text>{{text}}</text></g>"},require:["markerlabel","^trackmarker"],replace:!0,scope:{text:"@",valign:"@",vadjust:"@",halign:"@",hadjust:"@",type:"@",showline:"@",linestyle:"@",lineclass:"@",linevadjust:"@",labelclick:"&"},link:{pre:function(e,t,r,n){var a,i,u,l,c=n[0],d=n[1];"path"===r.type?(a=angular.element(t[0]),l=angular.element(t.children()[0]),i=angular.element(t.children()[1]),u=angular.element(t.children()[2])):(a=angular.element(t[0]),l=angular.element(t.children()[0]),u=angular.element(t.children()[1])),c.init(u,a,i,l,d)},post:function(t,r,n,a,i){i(t.$parent,function(e){r.append(e)});var u=a[0],l=a[1],c=angular.element(r),d=angular.element("path"===n.type?r.children()[2]:r.children()[1]);d.attr("text-anchor","middle"),d.attr("alignment-baseline","middle"),e.util.swapProperties(c,d),n.labelclick?d.on("click",function(e){t.labelclick({$event:e,$label:u})}):d.on("click",function(e){l.fireClick({$event:e,$marker:l})})}},controller:["$scope",function(t){var r,n,a,i,u,l;n=this,n.type="markerlabel",n.init=function(e,t,c,d,s){r=s,r.addMarkerLabel(n),n.marker=r,a=e,i=c,u=d,l=t},n.draw=function(){var e,t,l,c,d,s,o,f,p,g="middle",h="inner",m="outer",b="start",y="end";if("path"===n.type){switch(e=angular.element(a.children()[0]),t=window.getComputedStyle(a[0]).fontSize.replace("px",""),l=n.valign===m?0:n.valign===h?Number(t||0):Number(t||0)/2,i.attr("d",n.getPath(n.hadjust,n.vadjust-l,n.halign,n.valign)),n.halign){case b:a.attr("text-anchor","start"),e[0].setAttribute("startOffset","0%");break;case y:a.attr("text-anchor","end"),e[0].setAttribute("startOffset","100%");break;default:a.attr("text-anchor","middle"),e[0].setAttribute("startOffset","50%")}c="TPATH"+(Math.random()+1).toString(36).substring(3,7),i.attr("id",c),e.attr("xlink:href","#"+c)}else d=r.getPosition(n.hadjust,n.vadjust,n.halign,n.valign),a.attr("x",d.x),a.attr("y",d.y);n.showlineflg&&(s=r.getPosition(n.hadjust,n.vadjust+n.linevadjust,n.halign,n.valign),f=r.getPosition(),p=n.valign===h?f.inner:n.valign===g?f.middle:f.outer,o=n.halign===b?p.begin:n.halign===y?p.end:p.middle,u.attr("d",["M",s.x,s.y,"L",o.x,o.y].join(" ")),n.linestyle||n.lineclass||u.attr("style","stroke:#000"),n.linestyle&&u.attr("style",n.linestyle),n.lineclass&&u.attr("class",n.lineclass))},n.getPath=function(t,n,a,i){var u,l,c,d,s,o="inner",f="outer",p="start",g="end",h=r.center;switch(l=r.radius,i){case o:u=l.inner;break;case f:u=l.outer;break;default:u=l.middle}switch(c=r.angle,a){case p:d=c.start,s=c.start+359.99;break;case g:d=c.end+1,s=c.end;break;default:d=c.middle+180.05,s=c.middle+179.95}return e.svg.path.arc(h.x,h.y,u+Number(n||0),d+Number(t||0),s+Number(t||0),1)},Object.defineProperty(n,"showlineflg",{get:function(){return"1"===t.showline?!0:!1}}),Object.defineProperty(n,"halign",{get:function(){return t.halign||"middle"}}),Object.defineProperty(n,"valign",{get:function(){return t.valign||"middle"}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"type",{get:function(){return t.type}}),Object.defineProperty(n,"linevadjust",{get:function(){return e.util.Numeric(t.linevadjust)}}),Object.defineProperty(n,"linestyle",{get:function(){return t.linestyle}}),Object.defineProperty(n,"lineclass",{get:function(){return t.lineclass}}),Object.defineProperty(n,"text",{get:function(){return t.text}})}]}}])}();