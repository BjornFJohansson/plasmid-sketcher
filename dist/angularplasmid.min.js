!function(){"use strict";angular.module("angularplasmid.services",[]).factory("SVGUtil",function(){function e(e,t){var r="round";return"undefined"==typeof t||0===+t?Math[r](e):(e=+e,t=+t,isNaN(e)||"number"!=typeof t||t%1!==0?0/0:(e=e.toString().split("e"),e=Math[r](+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function t(e){p.push(e)}function r(e){var t;for(t=0;t<p.length;t+=1)if(p[t].id===e)return p[t]}function n(e,t,r,n){var a=(n-90)*Math.PI/180;return{x:e+r*Math.cos(a),y:t+r*Math.sin(a)}}function a(e,t){var r,n,a=["id","name","class","style","filter","ng-attr-style","ng-attr-class"];for(n=0;n<a.length;n+=1)r=a[n],e[0].hasAttribute(r)&&(t.attr(r,e.attr(r)),e.removeAttr(r))}function i(e,t,r){var n,a="http://www.w3.org/2000/svg",i=document.createElementNS(a,e);return r=r||[],angular.forEach(t,function(e){r.indexOf(e)<0&&(n=t[e],null===n||e.match(/\$/)||"string"==typeof n&&""===n||i.setAttribute(e,n))}),i}function l(e){angular.forEach(["id","class","style"],function(t){e.removeAttribute(t)})}function u(e,t,r,a){var i,l,u;return e=Number(e||0),t=Number(t||0),r=Number(r||0),a=Number(a||0),i={start:n(e,t,r,359.99),end:n(e,t,r,0)},l={start:n(e,t,r+a,359.99),end:n(e,t,r+a,0)},u=["M",i.start.x,i.start.y,"A",r,r,0,1,0,i.end.x,i.end.y,"M",l.start.x,l.start.y,"A",r+a,r+a,0,1,0,l.end.x,l.end.y].join(" ")}function c(e,t,r,a,i,l,u,c){var d,s,o,p,f,g,m,h,b,v,y,w,k;return e=Number(e),t=Number(t),r=Number(r),a=Number(a),i=Number(i),l=Number(l),u=u||{width:0,length:0,angle:0},c=c||{width:0,length:0,angle:0},a===i?(s=n(e,t,r,a),p=n(e,t,r+l,a),d=["M",s.x,s.y,"L",p.x,p.y].join(" ")):1===l?(s=n(e,t,r,a),p=n(e,t,r,i),f=i>a?180>=i-a?"0":"1":180>=i-a?"1":"0",d=["M",s.x,s.y,"A",r,r,0,f,1,p.x,p.y].join(" ")):(i-=c.length<0?0:c.length,a+=u.length<0?0:u.length,s=n(e,t,r,i),p=n(e,t,r,a),g=n(e,t,r-u.width,a+u.angle),m=n(e,t,r+l/2,a-u.length),h=n(e,t,r+l+u.width,a+u.angle),b=n(e,t,r+l,a),v=n(e,t,r+l+c.width,i-c.angle),y=n(e,t,r+l/2,i+c.length),w=n(e,t,r-c.width,i-c.angle),k=n(e,t,r,i),o=n(e,t,r+l,i),f=180>=i-a?"0":"1",d=["M",s.x,s.y,"A",r,r,0,f,0,p.x,p.y,"L",g.x,g.y,"L",m.x,m.y,"L",h.x,h.y,"L",b.x,b.y,"A",r+l,r+l,0,f,1,o.x,o.y,"L",v.x,v.y,"L",y.x,y.y,"L",w.x,w.y,"L",k.x,k.y,"z"].join(" ")),d}function d(t,r,n,a,i,l){t=Number(t||0),r=Number(r||0),n=Number(n||0),a=Number(a||0),i=Number(i||0),l=Number(l||2);var u,c,d,s,o=Number(a)>0?Number(i)/Number(a):0,p=2*Math.PI/o,f=-1,g="";for(s=0;o>s;s+=1)u=p*s-Math.PI/2,d=Math.cos(u),c=Math.sin(u),g+="M"+e(t+n*d,f)+","+e(r+n*c,f)+" L"+e(t+(n+l)*d,f)+","+e(r+(n+l)*c,f)+" ";return g=g||"M 0,0"}function s(t,r,n,a,i){t=Number(t),r=Number(r),n=Number(n),a=Number(a),i=Number(i);var l,u,c,d,s=Number(a)>0?Number(i)/Number(a):0,o=2*Math.PI/s,p=-1,f=[];for(d=0;s>d;d+=1)l=o*d-Math.PI/2,c=Math.cos(l),u=Math.sin(l),f.push({x:e(t+n*c,p),y:e(r+n*u,p),text:a*d});return f}function o(e,t){return isNaN(e)?t||0:Number(e)}var p=[],f=[],g=[];return{api:{addPlasmid:t,plasmids:p,plasmid:r,plasmidtracks:f,trackmarkers:g},util:{polarToCartesian:n,swapProperties:a,Numeric:o},svg:{createNode:i,removeAttributes:l,path:{donut:u,arc:c,scale:d},element:{scalelabels:s}}}})}(),function(){"use strict";angular.module("angularplasmid",["angularplasmid.services"]).directive("plasmidapi",["SVGUtil",function(e){return{restrict:"AE",link:function(t,r,n){t[n.name]=e.api}}}]).directive("plasmid",["SVGUtil",function(){return{restrict:"AE",type:"svg",template:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>',replace:!0,transclude:!0,require:"plasmid",scope:{plasmidheight:"@",plasmidwidth:"@",sequencelength:"@",sequence:"@"},link:{pre:function(e,t,r,n){n.init(t)},post:function(e,t,r,n,a){a(e.$parent,function(e){t.append(e)}),e.$watchGroup(["plasmidheight","plasmidwidth","sequencelength","sequence"],function(){n.draw()})}},controller:["$scope","SVGUtil",function(e,t){var r,n,a=[];n=this,n.type="plasmid",n.init=function(e){t.api.addPlasmid(n),r=e,n.id=r.attr("id")},n.draw=function(){var e=n.dimensions;r.attr("height",e.height),r.attr("width",e.width),angular.forEach(a,function(e){e.draw()})},n.addTrack=function(e){a.push(e)},Object.defineProperty(n,"center",{get:function(){var e=n.dimensions;return{x:e.width/2,y:e.height/2}}}),Object.defineProperty(n,"dimensions",{get:function(){return{height:t.util.Numeric(e.plasmidheight,300),width:t.util.Numeric(e.plasmidwidth,300)}}}),Object.defineProperty(n,"sequencelength",{get:function(){return n.sequence?n.sequence.length:t.util.Numeric(e.sequencelength)}}),Object.defineProperty(n,"sequence",{get:function(){return e.sequence}}),n.tracks=a}]}}]).directive("plasmidtrack",["SVGUtil","$compile",function(e,t){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["plasmidtrack","^plasmid"],scope:{radius:"@",width:"@",trackclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],l=angular.element(t.children()[0]);a.init(l,i)},post:function(r,n,a,i,l){l(r.$parent,function(e){n.append(e)});var u=angular.element(n),c=angular.element(n.children()[0]),d=i[0];e.util.swapProperties(u,c),c.attr("fill-rule","evenodd"),t(c)(r.$parent),c.on("click",function(e){r.trackclick({$event:e,$track:d})}),r.$watchGroup(["radius","width"],function(){d.draw()})}},controller:["$scope",function(t){var r,n,a,i=[],l=[],u=[];a=this,a.type="plasmidtrack",a.init=function(e,t){r=t,r.addTrack(a),a.plasmid=r,n=e},a.draw=function(){var t=a.center,r=e.svg.path.donut(t.x,t.y,a.radius,a.width);n.attr("d",r),angular.forEach(i,function(e){e.draw()}),angular.forEach(l,function(e){e.draw()}),angular.forEach(u,function(e){e.draw()})},a.addMarker=function(e){i.push(e)},a.addScale=function(e){l.push(e)},a.addLabel=function(e){u.push(e)},a.markergroup=function(e){var t=[];return angular.forEach(i,function(r){r.markergroup===e&&t.push(r)}),t},a.getPosition=function(t,n,i){i=Number(i||0),t=Number(t);var l,u,c=1,d=2,s=a.center,o=r.sequencelength;if(o>0){switch(u=t/o*360,n){case c:l=a.radius+i;break;case d:l=a.radius+a.width+i;break;default:l=a.radius+a.width/2+i}return e.util.polarToCartesian(s.x,s.y,l,u)}},Object.defineProperty(a,"center",{get:function(){return r.center}}),Object.defineProperty(a,"radius",{get:function(){return e.util.Numeric(t.radius,100)}}),Object.defineProperty(a,"width",{get:function(){return e.util.Numeric(t.width,25)}}),a.markers=i,a.scales=l,a.labels=u}]}}]).directive("trackscale",["SVGUtil","$compile",function(e,t){return{restrict:"AE",type:"svg",template:"<g><path></path><g></g></g>",replace:!0,transclude:!0,require:["trackscale","^plasmidtrack"],scope:{interval:"@",vadjust:"@",ticksize:"@",direction:"@",showlabels:"@",labelvadjust:"@",labelclass:"@",labelstyle:"@",scaleclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],l=angular.element(t.children()[0]),u=angular.element(t.children()[1]);a.init(l,u,i)},post:function(r,n,a,i,l){var u,c,d;l(r.$parent,function(e){n.append(e)}),u=angular.element(n),c=angular.element(n.children()[0]),e.util.swapProperties(u,c),t(c)(r.$parent),c.on("click",function(e){r.scaleclick({$event:e,$scale:d})}),d=i[0],r.$watchGroup(["interval","vadjust","ticksize","labelvadjust","direction","showlabels","labelstyle"],function(){d.draw()})}},controller:["$scope",function(t){var r,n,a,i,l=15,u=3;n=this,n.type="trackscale",n.init=function(e,t,l){r=l,r.addScale(n),n.track=r,a=e,i=t},n.draw=function(){var t=r.center,l=e.svg.path.scale(t.x,t.y,n.radius,n.interval,n.total,n.ticksize);a.attr("d",l),n.showlabels?n.drawLabel():i.empty()},n.drawLabel=function(){function a(e){t.scaleclick({$event:e,$scale:n})}var l,u,c,d=r.center;for(c=e.svg.element.scalelabels(d.x,d.y,n.labelradius,n.interval,n.total),i.empty(),l=0;l<=c.length-1;l+=1)u=angular.element(e.svg.createNode("text")),n.labelclass&&u.attr("class",n.labelclass),n.labelstyle&&u.attr("style",n.labelstyle),u.attr("x",c[l].x),u.attr("y",c[l].y),u.attr("text-anchor","middle"),u.attr("alignment-baseline","middle"),u.text(c[l].text),u.on("click",a),i.append(u)},Object.defineProperty(n,"radius",{get:function(){return(n.inwardflg?r.radius:r.radius+r.width)+(n.inwardflg?-1:1)*n.vadjust+(n.inwardflg?-n.ticksize:0)}}),Object.defineProperty(n,"interval",{get:function(){return e.util.Numeric(t.interval)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"ticksize",{get:function(){return e.util.Numeric(t.ticksize,u)}}),Object.defineProperty(n,"inwardflg",{get:function(){return"in"===t.direction?!0:!1}}),Object.defineProperty(n,"total",{get:function(){return r.plasmid.sequencelength}}),Object.defineProperty(n,"showlabels",{get:function(){return"1"===t.showlabels?!0:!1}}),Object.defineProperty(n,"labelvadjust",{get:function(){return e.util.Numeric(t.labelvadjust,l)}}),Object.defineProperty(n,"labelclass",{get:function(){return t.labelclass}}),Object.defineProperty(n,"labelstyle",{get:function(){return t.labelstyle}}),Object.defineProperty(n,"labelradius",{get:function(){return n.radius+n.labelvadjust*(n.inwardflg?-1:1)}})}]}}]).directive("tracklabel",["SVGUtil",function(e){return{restrict:"AE",type:"svg",template:"<text></text>",replace:!0,transclude:!0,require:["tracklabel","^plasmidtrack"],scope:{text:"@",hadjust:"@",vadjust:"@",labelclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],l=angular.element(t[0]);a.init(l,i)},post:function(e,t,r,n,a){var i;a(e.$parent,function(e){t.append(e)}),t.attr("text-anchor","middle"),t.attr("alignment-baseline","middle"),t.on("click",function(t){e.labelclick({$event:t,$label:i})}),i=n[0],e.$watchGroup(["text","vadjust","hadjust"],function(){i.draw()})}},controller:["$scope",function(t){var r,n,a;n=this,n.type="tracklabel",n.init=function(e,t){r=t,r.addLabel(n),n.track=r,a=e},n.draw=function(){var e=r.center;a.attr("x",e.x+n.hadjust),a.attr("y",e.y+n.vadjust),a.text(n.text)},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"text",{get:function(){return t.text}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust,0)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust,0)}}),Object.defineProperty(n,"dimensions",{get:function(){return a[0].getBBox()}})}]}}]).directive("trackmarker",["SVGUtil","$compile",function(e,t){return{restrict:"AE",type:"svg",template:"<g><path></path></g>",replace:!0,transclude:!0,require:["trackmarker","^plasmidtrack"],scope:{start:"@",end:"@",vadjust:"@",wadjust:"@",markergroup:"@",arrowstartlength:"@",arrowstartwidth:"@",arrowstartangle:"@",arrowendlength:"@",arrowendwidth:"@",arrowendangle:"@",markerclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],l=angular.element(t.children()[0]);a.init(l,i)},post:function(r,n,a,i,l){var u,c,d=i[0];l(r.$parent,function(e){n.append(e)}),u=angular.element(n),c=angular.element(n.children()[0]),e.util.swapProperties(u,c),t(c)(r.$parent),c.on("click",function(e){r.markerclick({$event:e,$marker:d})}),r.$watchGroup(["start","end","vadjust","wadjust","markergroup","arrowstartlength","arrowstartwidth","arrowstartangle","arrowendlength","arrowendwidth","arrowendangle"],function(){d.draw()})}},controller:["$scope",function(t){var r,n,a,i=[];n=this,n.type="trackmarker",n.init=function(e,t){r=t,r.addMarker(n),a=e,n.track=r},n.draw=function(){a.attr("d",n.getPath()),angular.forEach(i,function(e){e.draw()})},n.addMarkerLabel=function(e){i.push(e)},n.getPath=function(){var t=r.center,a=n.angle,i=n.radius;return e.svg.path.arc(t.x,t.y,i.inner,a.start,a.end,n.width,n.arrowstart,n.arrowend)},n.getPosition=function(t,a,i,l){var u,c,d,s,o,p="start",f="end",g="inner",m="outer";if(u=r.center,s=n.radius,o=n.angle,t=e.util.Numeric(t),a=e.util.Numeric(a),void 0!==l&&void 0!==i){switch(l){case g:c=s.inner+a;break;case m:c=s.outer+a;break;default:c=s.middle+a}switch(i){case p:d=o.start+t;break;case f:d=o.end+t;break;default:d=o.middle+t}return e.util.polarToCartesian(u.x,u.y,c,d)}return c={outer:s.outer+a,inner:s.inner+a,middle:s.middle+a},d={begin:o.start+t,end:o.end+t,middle:o.middle+t},{outer:{begin:e.util.polarToCartesian(u.x,u.y,c.outer,d.begin),middle:e.util.polarToCartesian(u.x,u.y,c.outer,d.middle),end:e.util.polarToCartesian(u.x,u.y,c.outer,d.end)},middle:{begin:e.util.polarToCartesian(u.x,u.y,c.middle,d.begin),middle:e.util.polarToCartesian(u.x,u.y,c.middle,d.middle),end:e.util.polarToCartesian(u.x,u.y,c.middle,d.end)},inner:{begin:e.util.polarToCartesian(u.x,u.y,c.inner,d.begin),middle:e.util.polarToCartesian(u.x,u.y,c.inner,d.middle),end:e.util.polarToCartesian(u.x,u.y,c.inner,d.end)}}},n.fireClick=function(e){t.markerclick({$event:e.$event,$marker:e.$marker})},Object.defineProperty(n,"center",{get:function(){return r.center}}),Object.defineProperty(n,"radius",{get:function(){return{inner:r.radius+n.vadjust,outer:r.radius+n.vadjust+n.width,middle:r.radius+n.vadjust+n.width/2}}}),Object.defineProperty(n,"angle",{get:function(){var a,i,l,u;return a=n.start/r.plasmid.sequencelength*360,u=t.end||t.start,i=e.util.Numeric(u)/r.plasmid.sequencelength*360,i+=a>i?360:0,l=a+(i-a)/2,{start:a,middle:l,end:i}}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"wadjust",{get:function(){return e.util.Numeric(t.wadjust)}}),Object.defineProperty(n,"width",{get:function(){return r.width+n.wadjust}}),Object.defineProperty(n,"start",{get:function(){return e.util.Numeric(t.start)}}),Object.defineProperty(n,"end",{get:function(){return e.util.Numeric(t.end)}}),Object.defineProperty(n,"arrowstart",{get:function(){return{width:e.util.Numeric(t.arrowstartwidth),length:e.util.Numeric(t.arrowstartlength),angle:e.util.Numeric(t.arrowstartangle)}}}),Object.defineProperty(n,"arrowend",{get:function(){return{width:e.util.Numeric(t.arrowendwidth),length:e.util.Numeric(t.arrowendlength),angle:e.util.Numeric(t.arrowendangle)}}}),Object.defineProperty(n,"markergroup",{get:function(){return t.markergroup}}),Object.defineProperty(n,"sequence",{get:function(){var e=n.track.plasmid.sequence;return n.start>n.end?e.substring(n.start-1,e.length-1)+e.substring(0,n.end-1):e.substring(n.start-1,n.end-1)}}),n.labels=i}]}}]).directive("markerlabel",["SVGUtil","$compile",function(e,t){return{restrict:"AE",type:"svg",transclude:!0,template:'<g><path></path><path id="" style="fill:none;stroke:none"></path><text>{{textnormal}}<textpath xlink:href="#">{{textpath}}</textpath></text></g>',require:["markerlabel","^trackmarker"],replace:!0,scope:{text:"@",valign:"@",vadjust:"@",halign:"@",hadjust:"@",type:"@",showline:"@",linestyle:"@",lineclass:"@",linevadjust:"@",labelclick:"&"},link:{pre:function(e,t,r,n){var a=n[0],i=n[1],l=angular.element(t[0]),u=angular.element(t.children()[0]),c=angular.element(t.children()[1]),d=angular.element(t.children()[2]);a.init(d,l,c,u,i)},post:function(r,n,a,i,l){l(r.$parent,function(e){n.append(e)});var u=i[0],c=i[1],d=angular.element(n),s=angular.element(n.children()[2]);s.attr("text-anchor","middle"),s.attr("alignment-baseline","middle"),e.util.swapProperties(d,s),t(s)(r.$parent),a.labelclick?s.on("click",function(e){r.labelclick({$event:e,$label:u})}):s.on("click",function(e){c.fireClick({$event:e,$marker:c})}),r.$watchGroup(["text","type","valign","vadjust","halign","hadjust","showline","linevadjust","linestyle"],function(){u.draw()})}},controller:["$scope",function(t){var r,n,a,i,l,u;n=this,n.type="markerlabel",n.init=function(e,t,c,d,s){var o="TPATH"+(Math.random()+1).toString(36).substring(3,7),p=angular.element(e.children()[0]);r=s,r.addMarkerLabel(n),n.marker=r,a=e,i=c,l=d,u=t,i.attr("id",o),p.attr("xlink:href","#"+o)},n.draw=function(){var e,u,c,d,s,o,p="middle",f="inner",g="outer",m="start",h="end",b=0,v=0;if("path"===n.type)switch(t.textnormal=null,t.textpath=n.text,a.removeAttr("x"),a.removeAttr("y"),e=angular.element(a.children()[0]),b=window.getComputedStyle(a[0]).fontSize.replace("px",""),v=n.valign===g?0:n.valign===f?Number(b||0):Number(b||0)/2,i.attr("d",n.getPath(n.hadjust,n.vadjust-v,n.halign,n.valign)),n.halign){case m:a.attr("text-anchor","start"),e[0].setAttribute("startOffset","0%");break;case h:a.attr("text-anchor","end"),e[0].setAttribute("startOffset","100%");break;default:a.attr("text-anchor","middle"),e[0].setAttribute("startOffset","50%")}else t.textnormal=n.text,t.textpath=null,u=r.getPosition(n.hadjust,n.vadjust,n.halign,n.valign),a.attr("x",u.x),a.attr("y",u.y);n.showlineflg?(c=r.getPosition(n.hadjust,n.vadjust+n.linevadjust,n.halign,n.valign),s=r.getPosition(),o=n.valign===f?s.inner:n.valign===p?s.middle:s.outer,d=n.halign===m?o.begin:n.halign===h?o.end:o.middle,l.attr("d",["M",c.x,c.y,"L",d.x,d.y].join(" ")),n.linestyle||n.lineclass||l.attr("style","stroke:#000"),n.linestyle&&l.attr("style",n.linestyle),n.lineclass&&l.attr("class",n.lineclass)):l.removeAttr("d")},n.getPath=function(t,n,a,i){var l,u,c,d,s,o="inner",p="outer",f="start",g="end",m=r.center;switch(u=r.radius,i){case o:l=u.inner;break;case p:l=u.outer;break;default:l=u.middle}switch(c=r.angle,a){case f:d=c.start,s=c.start+359.99;break;case g:d=c.end+1,s=c.end;break;default:d=c.middle+180.05,s=c.middle+179.95}return e.svg.path.arc(m.x,m.y,l+Number(n||0),d+Number(t||0),s+Number(t||0),1)},Object.defineProperty(n,"showlineflg",{get:function(){return"1"===t.showline?!0:!1}}),Object.defineProperty(n,"halign",{get:function(){return t.halign||"middle"}}),Object.defineProperty(n,"valign",{get:function(){return t.valign||"middle"}}),Object.defineProperty(n,"hadjust",{get:function(){return e.util.Numeric(t.hadjust)}}),Object.defineProperty(n,"vadjust",{get:function(){return e.util.Numeric(t.vadjust)}}),Object.defineProperty(n,"type",{get:function(){return t.type}}),Object.defineProperty(n,"linevadjust",{get:function(){return e.util.Numeric(t.linevadjust)}}),Object.defineProperty(n,"linestyle",{get:function(){return t.linestyle}}),Object.defineProperty(n,"lineclass",{get:function(){return t.lineclass}}),Object.defineProperty(n,"text",{get:function(){return t.text}})}]}}]).directive("svgelement",["SVGUtil",function(){return{restrict:"AE",template:function(e,t){return"<"+t.type+"></"+t.type+">"},type:"svg",replace:!0,transclude:!0,require:["^plasmid"],scope:{},link:function(e,t,r,n,a){a(e.$parent,function(e){t.append(e)})}}}])}();